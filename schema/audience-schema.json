{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "AbsoluteDate": {
      "additionalProperties": false,
      "properties": {
        "absolute": {
          "type": "string"
        }
      },
      "required": [
        "absolute"
      ],
      "type": "object"
    },
    "AggregationOperator": {
      "enum": [
        "min",
        "max",
        "sum",
        "avg",
        "list",
        "count"
      ],
      "type": "string"
    },
    "ArithmeticOperator": {
      "enum": [
        "plus",
        "minus",
        "multiply",
        "divide",
        "mod"
      ],
      "type": "string"
    },
    "Audience": {
      "title": "AudienceDefinition",
      "additionalProperties": false,
      "properties": {
        "audience": {
          "title": "Audience",
          "additionalProperties": false,
          "properties": {
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            },
            "queries": {
              "items": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/LogicalAudienceQueries"
                  },
                  {
                    "$ref": "#/definitions/AudienceQuery"
                  }
                ]
              },
              "type": "array"
            },
            "version": {
              "$ref": "#/definitions/Version"
            }
          },
          "required": [
            "operator",
            "queries",
            "version"
          ],
          "type": "object"
        }
      },
      "required": [
        "audience"
      ],
      "type": "object"
    },
    "AudienceQuery": {
      "anyOf": [
        {
          "additionalProperties": false,
          "properties": {
            "query": {
              "$ref": "#/definitions/Query"
            }
          },
          "required": [
            "query"
          ],
          "type": "object"
        },
        {
          "title": "EventAudienceQuery",
          "additionalProperties": false,
          "properties": {
            "event": {
              "$ref": "#/definitions/EventQuery"
            }
          },
          "required": [
            "event"
          ],
          "type": "object"
        },
        {
          "title": "UserAudienceQuery",
          "additionalProperties": false,
          "properties": {
            "user": {
              "$ref": "#/definitions/UserQuery"
            }
          },
          "required": [
            "user"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "BinaryOperator": {
      "enum": [
        "equals",
        "less_than",
        "less_than_equal",
        "greater_than",
        "greater_than_equal",
        "matches",
        "contains"
      ],
      "type": "string"
    },
    "CountExpression": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "additionalProperties": false,
          "properties": {
            "operand": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "expressions": {
              "items": {
                "$ref": "#/definitions/CountExpression"
              },
              "type": "array"
            },
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            }
          },
          "required": [
            "operator",
            "expressions"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "DateExpression": {
      "anyOf": [
        {
          "$ref": "#/definitions/AbsoluteDate"
        },
        {
          "$ref": "#/definitions/RelativeDate"
        },
        {
          "additionalProperties": false,
          "properties": {
            "operand": {
              "anyOf": [
                {
                  "$ref": "#/definitions/AbsoluteDate"
                },
                {
                  "$ref": "#/definitions/RelativeDate"
                }
              ]
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "expressions": {
              "items": {
                "$ref": "#/definitions/DateExpression"
              },
              "type": "array"
            },
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            }
          },
          "required": [
            "operator",
            "expressions"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "DateOperand": {
      "anyOf": [
        {
          "title": "AbsoluteDateOperand",
          "additionalProperties": false,
          "properties": {
            "date": {
              "$ref": "#/definitions/AbsoluteDate"
            }
          },
          "required": [
            "date"
          ],
          "type": "object"
        },
        {
          "title": "RelativeDateOperand",
          "additionalProperties": false,
          "properties": {
            "date": {
              "$ref": "#/definitions/RelativeDate"
            }
          },
          "required": [
            "date"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "DateUnit": {
      "enum": [
        "second",
        "minute",
        "hour",
        "day",
        "week",
        "month",
        "quarter",
        "year"
      ],
      "type": "string"
    },
    "DistanceUnit": {
      "enum": [
        "meters",
        "miles",
        "kilometers"
      ],
      "type": "string"
    },
    "EventQuery": {
      "additionalProperties": false,
      "properties": {
        "attributes": {
          "$ref": "#/definitions/SingleModelExpression"
        },
        "count": {
          "$ref": "#/definitions/CountExpression"
        },
        "date": {
          "$ref": "#/definitions/DateExpression"
        },
        "event_name": {
          "$ref": "#/definitions/PathExpression"
        },
        "event_type": {
          "$ref": "#/definitions/PathExpression"
        },
        "expression": {
          "$ref": "#/definitions/Expression"
        },
        "location": {
          "$ref": "#/definitions/LocationExpression"
        },
        "models": {
          "$ref": "#/definitions/Models"
        }
      },
      "required": [
        "models"
      ],
      "type": "object"
    },
    "Expression": {
      "anyOf": [
        {
          "title": "JoinExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/Expression"
            },
            "model": {
              "$ref": "#/definitions/Model"
            }
          },
          "required": [
            "model",
            "expression"
          ],
          "type": "object"
        },
        {
          "title": "UnaryExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/Expression"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "const": "not",
              "type": "string"
            }
          },
          "required": [
            "operator",
            "expression"
          ],
          "type": "object"
        },
        {
          "title": "ExistsExpression",
          "additionalProperties": false,
          "properties": {
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operand": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "const": "exists",
              "type": "string"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        },
        {
          "title": "BinaryExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/Operand"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            },
            "right": {
              "$ref": "#/definitions/Operand"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "ModelAggregationLeftExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/Expression"
            },
            "left": {
              "$ref": "#/definitions/AggregationObject"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            },
            "right": {
              "$ref": "#/definitions/Operand"
            }
          },
          "required": [
            "model",
            "operator",
            "expression",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "ModelAggregationRightExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/Expression"
            },
            "left": {
              "$ref": "#/definitions/Operand"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            },
            "right": {
              "$ref": "#/definitions/AggregationObject"
            }
          },
          "required": [
            "model",
            "operator",
            "expression",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "LogicalExpression",
          "additionalProperties": false,
          "properties": {
            "expressions": {
              "items": {
                "$ref": "#/definitions/Expression"
              },
              "type": "array"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            }
          },
          "required": [
            "operator",
            "expressions"
          ],
          "type": "object"
        },
        {
          "title": "LocationLeftExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/LocationOperand"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/LocationOperator"
            },
            "right": {
              "$ref": "#/definitions/ModelPath"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "LocationRightExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/ModelPath"
            },
            "model": {
              "$ref": "#/definitions/Model"
            },
            "operator": {
              "$ref": "#/definitions/LocationOperator"
            },
            "right": {
              "$ref": "#/definitions/LocationOperand"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "ListOperator": {
      "enum": [
        "contains",
        "between",
        "match_any",
        "match_all",
        "in"
      ],
      "type": "string"
    },
    "Location": {
      "additionalProperties": false,
      "properties": {
        "distance": {
          "additionalProperties": false,
          "properties": {
            "unit": {
              "$ref": "#/definitions/DistanceUnit"
            },
            "value": {
              "type": "number"
            }
          },
          "required": [
            "value",
            "unit"
          ],
          "type": "object"
        },
        "latitude": {
          "type": "number"
        },
        "longitude": {
          "type": "number"
        }
      },
      "required": [
        "latitude",
        "longitude"
      ],
      "type": "object"
    },
    "LocationExpression": {
      "anyOf": [
        {
          "$ref": "#/definitions/Location"
        },
        {
          "additionalProperties": false,
          "properties": {
            "operand": {
              "$ref": "#/definitions/Location"
            },
            "operator": {
              "$ref": "#/definitions/LocationOperator"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        },
        {
          "additionalProperties": false,
          "properties": {
            "expressions": {
              "items": {
                "$ref": "#/definitions/LocationExpression"
              },
              "type": "array"
            },
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            }
          },
          "required": [
            "operator",
            "expressions"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "LocationOperand": {
      "additionalProperties": false,
      "properties": {
        "location": {
          "$ref": "#/definitions/Location"
        }
      },
      "required": [
        "location"
      ],
      "type": "object"
    },
    "LocationOperator": {
      "enum": [
        "within",
        "equals"
      ],
      "type": "string"
    },
    "LogicalAudienceQueries": {
      "additionalProperties": false,
      "properties": {
        "operator": {
          "$ref": "#/definitions/LogicalOperator"
        },
        "queries": {
          "items": {
            "anyOf": [
              {
                "$ref": "#/definitions/LogicalAudienceQueries"
              },
              {
                "$ref": "#/definitions/AudienceQuery"
              }
            ]
          },
          "type": "array"
        }
      },
      "required": [
        "operator",
        "queries"
      ],
      "type": "object"
    },
    "LogicalOperator": {
      "enum": [
        "and",
        "or"
      ],
      "type": "string"
    },
    "Model": {
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "number"
        },
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "id"
      ],
      "type": "object"
    },
    "Models": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Model"
      }
    },
    "Operand": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "type": "number"
        },
        {
          "type": "string"
        },
        {
          "$ref": "#/definitions/DateOperand"
        },
        {
          "title": "PathOperand",
          "additionalProperties": false,
          "$ref": "#/definitions/ModelPath"
        },
        {
          "title": "ArithmeticOperand",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "$ref": "#/definitions/ArithmeticOperator"
            },
            "right": {
              "$ref": "#/definitions/Operand"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "PathExpression": {
      "anyOf": [
        {
          "title": "BooleanPathExpression",
          "type": "boolean"
        },
        {
          "title": "NumberPathExpression",
          "type": "number"
        },
        {
          "title": "StringPathExpression",
          "type": "string"
        },
        {
          "title": "UnaryPathExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/PathExpression"
            },
            "operator": {
              "$ref": "#/definitions/UnaryOperator"
            }
          },
          "required": [
            "operator",
            "expression"
          ],
          "type": "object"
        },
        {
          "title": "BinaryPathExpression",
          "additionalProperties": false,
          "properties": {
            "operand": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "Query": {
      "additionalProperties": false,
      "properties": {
        "expression": {
          "$ref": "#/definitions/Expression"
        },
        "models": {
          "$ref": "#/definitions/Models"
        }
      },
      "required": [
        "models"
      ],
      "type": "object"
    },
    "RelativeDate": {
      "additionalProperties": false,
      "properties": {
        "relative": {
          "additionalProperties": false,
          "properties": {
            "boundary": {
              "enum": [
                "start",
                "end",
                "middle"
              ],
              "type": "string"
            },
            "offset": {
              "type": "number"
            },
            "unit": {
              "$ref": "#/definitions/DateUnit"
            }
          },
          "required": [
            "offset",
            "unit"
          ],
          "type": "object"
        }
      },
      "required": [
        "relative"
      ],
      "type": "object"
    },
    "SingleModelExpression": {
      "anyOf": [
        {
          "title": "NotSingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "expression": {
              "$ref": "#/definitions/SingleModelExpression"
            },
            "operator": {
              "const": "not",
              "type": "string"
            }
          },
          "required": [
            "operator",
            "expression"
          ],
          "type": "object"
        },
        {
          "title": "ExistsSingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "operand": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "const": "exists",
              "type": "string"
            }
          },
          "required": [
            "operator",
            "operand"
          ],
          "type": "object"
        },
        {
          "title": "BinarySingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/Operand"
            },
            "operator": {
              "$ref": "#/definitions/BinaryOperator"
            },
            "right": {
              "$ref": "#/definitions/Operand"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "LogicalSingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "expressions": {
              "items": {
                "$ref": "#/definitions/SingleModelExpression"
              },
              "type": "array"
            },
            "operator": {
              "$ref": "#/definitions/LogicalOperator"
            }
          },
          "required": [
            "operator",
            "expressions"
          ],
          "type": "object"
        },
        {
          "title": "LocationSingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/LocationOperand"
            },
            "operator": {
              "$ref": "#/definitions/LocationOperator"
            },
            "right": {
              "$ref": "#/definitions/ModelPath"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        },
        {
          "title": "LocationRightSingleModelExpression",
          "additionalProperties": false,
          "properties": {
            "left": {
              "$ref": "#/definitions/ModelPath"
            },
            "operator": {
              "$ref": "#/definitions/LocationOperator"
            },
            "right": {
              "$ref": "#/definitions/LocationOperand"
            }
          },
          "required": [
            "operator",
            "left",
            "right"
          ],
          "type": "object"
        }
      ],
      "type": "object"
    },
    "UnaryOperator": {
      "enum": [
        "not",
        "exist"
      ],
      "type": "string"
    },
    "UserQuery": {
      "additionalProperties": false,
      "properties": {
        "attributes": {
          "$ref": "#/definitions/SingleModelExpression"
        },
        "expression": {
          "$ref": "#/definitions/Expression"
        },
        "models": {
          "$ref": "#/definitions/Models"
        }
      },
      "required": [
        "attributes",
        "models"
      ],
      "type": "object"
    },
    "Version": {
      "type": [
        "string"
      ]
    },
    "ModelPath": {
      "additionalProperties": false,
      "properties": {
        "model": { "type": "string" },
        "path": { "type": "string" }
      },
      "required": ["model", "path"],
      "type": "object"
    },
    "AggregationObject": {
      "additionalProperties": false,
      "properties": {
        "group_by": { "$ref": "#/definitions/ModelPath" },
        "operator": { "$ref": "#/definitions/AggregationOperator" },
        "expression": { "$ref": "#/definitions/ModelPath" },
        "conditions": { "$ref": "#/definitions/Expression" }
      },
      "required": ["group_by", "operator", "expression", "conditions"],
      "type": "object"
    }
  }
}
